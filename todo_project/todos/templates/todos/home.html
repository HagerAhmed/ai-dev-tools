{% extends "base.html" %}
{% block title %}My Tasks{% endblock %}

{% block content %}

<!-- Search Bar -->
<form method="GET" class="mb-4">
    <input type="text" name="search" value="{{ search }}" class="form-control" placeholder="Search tasks...">
</form>

<!-- Progress Bar -->
<div class="mb-4">
    <label class="mb-1">Progress</label>
    <div class="progress" style="height: 18px;">
        <div 
            class="progress-bar" 
            role="progressbar" 
            style="width: {{ progress }}%;"
        >
            {{ progress }}%
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <!-- Add Task -->
        <div class="card p-4 mb-4">
            <h4 class="mb-3">Add New Task</h4>

            <form method="POST">
                {% csrf_token %}
                {{ form.as_p }}
                <button class="btn btn-primary w-100">Add Task</button>
            </form>
        </div>
    </div>

    <div class="col-md-6">
        <!-- Task List -->
        <div class="card p-4">
            <h4 class="mb-3">My Tasks</h4>

            {% if todos %}
                <ul class="list-group">

                    {% for todo in todos %}
                    <li class="list-group-item d-flex justify-content-between align-items-center mb-2" style="border-radius: 8px; animation: fadeIn 0.4s ease;">
                        <div>
                            <h6 class="mb-1">
                                {% if todo.completed %}
                                    <del>{{ todo.title }}</del>
                                {% else %}
                                    {{ todo.title }}
                                {% endif %}
                            </h6>

                            <small class="
                                {% if todo.priority == 'high' %}text-danger
                                {% elif todo.priority == 'medium' %}text-warning
                                {% else %}text-success
                                {% endif %}
                            ">
                                Priority: {{ todo.priority|capfirst }}
                            </small>

                            {% if todo.due_date %}
                                <br><small class="text-muted">Due: {{ todo.due_date }}</small>
                            {% endif %}
                        </div>

                        <div>
                            <a href="/toggle/{{ todo.id }}/" class="btn btn-sm btn-success me-1">✓</a>
                            <a href="/edit/{{ todo.id }}/" class="btn btn-sm btn-warning me-1">✎</a>
                            <a href="/delete/{{ todo.id }}/" class="btn btn-sm btn-danger">✕</a>
                        </div>
                    </li>
                    {% endfor %}

                </ul>
            {% else %}
                <p class="text-muted">No tasks found.</p>
            {% endif %}
        </div>
    </div>
</div>

<style>
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

{% endblock %}
